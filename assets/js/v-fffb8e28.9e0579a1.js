"use strict";(self.webpackChunknode_red_contrib_power_saver=self.webpackChunknode_red_contrib_power_saver||[]).push([[807],{9570:(e,t,n)=>{n.r(t),n.d(t,{data:()=>r});const r={key:"v-fffb8e28",path:"/guide/",title:"Guide",lang:"en-US",frontmatter:{sidebar:"auto"},excerpt:"",headers:[{level:2,title:"Introduction",slug:"introduction",children:[]},{level:2,title:"Getting started",slug:"getting-started",children:[{level:3,title:"Installation",slug:"installation",children:[]},{level:3,title:"Get price data",slug:"get-price-data",children:[]},{level:3,title:"Add grid tariff",slug:"add-grid-tariff",children:[]},{level:3,title:"Calculate and run schedule",slug:"calculate-and-run-schedule",children:[]},{level:3,title:"Use schedule signals",slug:"use-schedule-signals",children:[]},{level:3,title:"Display schedule",slug:"display-schedule",children:[]},{level:3,title:"More information",slug:"more-information",children:[]}]},{level:2,title:"Migration from v2",slug:"migration-from-v2",children:[]}],filePathRelative:"guide/README.md",git:{updatedTime:1640086064e3,contributors:[{name:"Otto Paulsen",email:"ottpau@gmail.com",commits:4}]}}},8999:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Je});var r=n(6252),l=n(1321),a=n(3405),o=n(1758);const s=(0,r._)("h1",{id:"guide",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#guide","aria-hidden":"true"},"#"),(0,r.Uk)(" Guide")],-1),i=(0,r._)("h2",{id:"introduction",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#introduction","aria-hidden":"true"},"#"),(0,r.Uk)(" Introduction")],-1),u=(0,r.Uk)("This is a collection of nodes for the popular "),d={href:"https://nodered.org/",target:"_blank",rel:"noopener noreferrer"},c=(0,r.Uk)("Node-RED"),h=(0,r.Uk)(" that you can use to save money on variable electricity prices. Node-RED is a widely used low-code programming tool that can be used together with many smart home solutions to create automations."),p=(0,r._)("p",null,[(0,r.Uk)("The solution can be used to control switches or other entities in a smart home system, and for example turn on when the price is low, and turn off when the price is high. There are different ways to calculate what hours to turn on and off, and these are implemented as "),(0,r._)("strong",null,"strategies nodes"),(0,r.Uk)(". Each strategy node can be configured to fit different purposes.")],-1),_=(0,r._)("p",null,"The strategies need price data to work. These can be received from different sources, for example Tibber, Nord Pool or custom sources.",-1),b=(0,r._)("div",{class:"custom-container warning"},[(0,r._)("p",{class:"custom-container-title"},"Price sources"),(0,r._)("p",null,"Tibber and Nord Pool are only available in the nordics, so if you live outside the nordics, you must find another source of price data, and make your own input.")],-1),m=(0,r._)("p",null,[(0,r.Uk)("Grid tariff is normally not part of the electricity price, so if this varies by the hour, it must be added before sent to the strategy nodes for calculation. This can be done by putting a "),(0,r._)("code",null,"ps-xxx-add-tariff"),(0,r.Uk)(" node between the price receiver and the strategy.")],-1),f=(0,r._)("p",null,'The strategy nodes have 3 outputs. Output 1 is used to "turn on", output 2 is used to "turn off", and on output 3, the calculated schedule and some other information is sent. You can use this to make graphs, or just send it to a debug node to view it.',-1),g=(0,r._)("p",null,"Example:",-1),v=(0,r._)("p",null,[(0,r._)("img",{src:l,alt:"Example flow"})],-1),y=(0,r._)("p",null,[(0,r.Uk)("Here prices are received from Tibber, converted in the "),(0,r._)("code",null,"ps-receive-price"),(0,r.Uk)(" node, then grid tariff for Elvia is added before sent to the "),(0,r._)("code",null,"ps-strategy-best-save"),(0,r.Uk)(" node. Output is sent to Home Assistant via two "),(0,r._)("code",null,"call-service"),(0,r.Uk)(" nodes, and the schedule is sent to a debug node.")],-1),k=(0,r._)("div",{class:"custom-container tip"},[(0,r._)("p",{class:"custom-container-title"},"Home Assistant"),(0,r._)("p",null,"The node collection fits very well with Home Assistant (HA), as Node-RED is frequently used for automations, and there also is an integration with Nord Pool, but there is no direct dependency to HA, so all nodes can be used also without HA.")],-1),w=(0,r._)("h2",{id:"getting-started",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#getting-started","aria-hidden":"true"},"#"),(0,r.Uk)(" Getting started")],-1),U=(0,r._)("h3",{id:"installation",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#installation","aria-hidden":"true"},"#"),(0,r.Uk)(" Installation")],-1),x=(0,r._)("p",null,"Install in Node-RED via the Manage Palette menu.",-1),T=(0,r._)("p",null,"May also be installed via npm:",-1),A=(0,r._)("p",null,[(0,r._)("code",null,"npm install node-red-contrib-power-saver")],-1),S=(0,r._)("p",null,[(0,r.Uk)("Make sure that you upgrade now and then to get the latest version. See "),(0,r._)("a",{href:"CHANGELOG"},"changelog"),(0,r.Uk)(" for changes.")],-1),q=(0,r._)("h3",{id:"get-price-data",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#get-price-data","aria-hidden":"true"},"#"),(0,r.Uk)(" Get price data")],-1),N=(0,r._)("p",null,"This solution is useless without price data. In the nordics, there are at least two very common places to get price data from:",-1),P=(0,r._)("ul",null,[(0,r._)("li",null,"Tibber"),(0,r._)("li",null,"Nord Pool")],-1),E=(0,r._)("p",null,[(0,r.Uk)("The "),(0,r._)("code",null,"ps-receive-price"),(0,r.Uk)(" node is designed to handle price input from both these, and convert it to the format required by the strategy nodes.")],-1),W=(0,r.Uk)("If you are a Tibber customer, use the "),H=(0,r._)("code",null,"tibber-query",-1),I=(0,r.Uk)(" node from the "),M={href:"https://flows.nodered.org/node/node-red-contrib-tibber-api",target:"_blank",rel:"noopener noreferrer"},C=(0,r.Uk)("Tibber API"),G=(0,r.Uk)(" to receive price, with one of the following queries:"),D=(0,r._)("div",{class:"language-gql ext-gql line-numbers-mode"},[(0,r._)("pre",{class:"language-gql"},[(0,r._)("code",null,"{\n  viewer {\n    homes {\n      id\n      address {\n        address1\n        address2\n        address3\n        postalCode\n        city\n        country\n      }\n    }\n  }\n}\n")]),(0,r._)("div",{class:"line-numbers"},[(0,r._)("span",{class:"line-number"},"1"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"2"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"3"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"4"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"5"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"6"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"7"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"8"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"9"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"10"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"11"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"12"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"13"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"14"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"15"),(0,r._)("br")])],-1),O=(0,r._)("div",{class:"language-gql ext-gql line-numbers-mode"},[(0,r._)("pre",{class:"language-gql"},[(0,r._)("code",null,'{\n  viewer {\n    home(id: "142c1670-ab43-2ab3-ba6d-723703a551e2") {\n      currentSubscription{\n        priceInfo{\n          today {\n            total\n            energy\n            tax\n            startsAt\n          }\n          tomorrow {\n            total\n            energy\n            tax\n            startsAt\n          }\n        }\n      }\n    }\n  }\n}\n')]),(0,r._)("div",{class:"highlight-lines"},[(0,r._)("br"),(0,r._)("br"),(0,r._)("div",{class:"highlight-line"},"Â "),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br"),(0,r._)("br")]),(0,r._)("div",{class:"line-numbers"},[(0,r._)("span",{class:"line-number"},"1"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"2"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"3"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"4"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"5"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"6"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"7"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"8"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"9"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"10"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"11"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"12"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"13"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"14"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"15"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"16"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"17"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"18"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"19"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"20"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"21"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"22"),(0,r._)("br")])],-1),R=(0,r._)("p",null,[(0,r.Uk)("See more details in the "),(0,r._)("a",{href:"../nodes/ps-receive-price#tibber-input"},"documentation"),(0,r.Uk)(" for the "),(0,r._)("code",null,"ps-receive-price"),(0,r.Uk)(" node.")],-1),Y=(0,r.Uk)("Se documentation for "),L={href:"https://flows.nodered.org/node/node-red-contrib-tibber-api",target:"_blank",rel:"noopener noreferrer"},j=(0,r.Uk)("node-red-contrib-tibber-api"),B=(0,r.Uk)(" for details about the Tibber query."),Z=(0,r._)("div",{class:"custom-container tip"},[(0,r._)("p",{class:"custom-container-title"},"Tibber query"),(0,r._)("p",null,[(0,r.Uk)("You can use an "),(0,r._)("code",null,"inject"),(0,r.Uk)(" node (standard Node-RED) to send the Tibber query as a text string int to the "),(0,r._)("code",null,"tibber-query"),(0,r.Uk)(" node. This can be set to repeat the query for example every hour.")])],-1),F=(0,r.Uk)("See example of Tibber flow and mqtt"),z=(0,r.Uk)("If you use Home Assistant (HA), you can install the "),J={href:"https://github.com/custom-components/nordpool",target:"_blank",rel:"noopener noreferrer"},K=(0,r.Uk)("Nord Pool custom component"),Q=(0,r.Uk)(", that provides a "),V=(0,r._)("em",null,"sensor",-1),X=(0,r.Uk)(" that gives price per hour for today and tomorrow. Data can be sent from both the "),$=(0,r._)("code",null,"current state",-1),ee=(0,r.Uk)(" node or the "),te=(0,r._)("code",null,"events: state",-1),ne=(0,r.Uk)(" node."),re=(0,r.Uk)("See example with Nord Pool and "),le=(0,r._)("code",null,"current state",-1),ae=(0,r.Uk)(" node"),oe=(0,r.Uk)("See example with Nord Pool and "),se=(0,r._)("code",null,"events: state",-1),ie=(0,r.Uk)(" node"),ue=(0,r._)("h3",{id:"add-grid-tariff",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#add-grid-tariff","aria-hidden":"true"},"#"),(0,r.Uk)(" Add grid tariff")],-1),de=(0,r._)("p",null,"When also the grid tariff changes per hour, it must be added to the electricity price in order to get the calculations right.",-1),ce=(0,r._)("p",null,[(0,r.Uk)("After the the "),(0,r._)("code",null,"ps-receive-price"),(0,r.Uk)(" node, add a "),(0,r._)("code",null,"ps-xxx-add-tariff"),(0,r.Uk)(" node to add grid tariff. What node to choose depends on what grid you get electricity through. The following grids are supported:")],-1),he=(0,r._)("table",null,[(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"Grid supplier"),(0,r._)("th",null,"Node")])]),(0,r._)("tbody",null,[(0,r._)("tr",null,[(0,r._)("td",null,"Elvia"),(0,r._)("td",null,[(0,r._)("code",null,"ps-elvia-add-tariff")])])])],-1),pe=(0,r._)("p",null,"Oops. Only one grid is currently supported.",-1),_e=(0,r._)("p",null,"If your grid is not supported, you may code this yourself.",-1),be=(0,r._)("div",{class:"custom-container tip"},[(0,r._)("p",{class:"custom-container-title"},"Skip this step"),(0,r._)("p",null,"If the grid tariff is the same the whole day, you can skip this step i the flow.")],-1),me=(0,r._)("h3",{id:"calculate-and-run-schedule",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#calculate-and-run-schedule","aria-hidden":"true"},"#"),(0,r.Uk)(" Calculate and run schedule")],-1),fe=(0,r._)("p",null,"This is the step where the value is produced. Based on the prices received, the optimal schedule for you is calculated automatically, based on your configuration. You can choose between the following strategies:",-1),ge=(0,r._)("table",null,[(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"Strategy"),(0,r._)("th",null,"Node"),(0,r._)("th",null,"Description")])]),(0,r._)("tbody",null,[(0,r._)("tr",null,[(0,r._)("td",null,"Best save"),(0,r._)("td",null,[(0,r._)("code",null,"ps-strategy-best-save")]),(0,r._)("td",null,"Postpone power consumption when there is most to save.")]),(0,r._)("tr",null,[(0,r._)("td",null,"Lowest price"),(0,r._)("td",null,[(0,r._)("code",null,"ps--strategy-lowest-price")]),(0,r._)("td",null,"Turn on power when the prices are the lowest in a given period.")])])],-1),ve=(0,r._)("p",null,"These nodes must be configured for your purpose. See configuration description and other details in the documentation for each node.",-1),ye=(0,r._)("p",null,[(0,r.Uk)("Send the result from the "),(0,r._)("code",null,"ps-xxx-add-tariff"),(0,r.Uk)(" node (or the "),(0,r._)("code",null,"ps-receive-price"),(0,r.Uk)(" node) as input to the strategy node you choose.")],-1),ke=(0,r._)("div",{class:"custom-container tip"},[(0,r._)("p",{class:"custom-container-title"},"Choose strategy"),(0,r._)("p",null,"Choose the best save strategy if you can postpone power consumption, and expect the consumption to occur during the first hour after power is turned on again."),(0,r._)("p",null,"Choose the lowest price strategy if you need the power to be on for x hours, but it is not important when that is. Note that you can select to have all hours on in one consecutive period, or spread around on the cheapest hours.")],-1),we=(0,r._)("h3",{id:"use-schedule-signals",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#use-schedule-signals","aria-hidden":"true"},"#"),(0,r.Uk)(" Use schedule signals")],-1),Ue=(0,r._)("p",null,"Use the outputs to control switches, thermostats or other entities to control your power consumers.",-1),xe=(0,r._)("p",null,[(0,r._)("strong",null,"Output 1"),(0,r.Uk)(" is used to turn on. A payload with value "),(0,r._)("code",null,"true"),(0,r.Uk)(" is sent every time turning on is scheduled.")],-1),Te=(0,r._)("p",null,[(0,r._)("strong",null,"Output 2"),(0,r.Uk)(" is used to turn off. A payload with value "),(0,r._)("code",null,"false"),(0,r.Uk)(" is sent every time turning off is scheduled.")],-1),Ae=(0,r._)("p",null,"Example using Home Assistant:",-1),Se=(0,r._)("p",null,[(0,r._)("img",{src:a,alt:"Example flow"})],-1),qe=(0,r._)("div",{class:"custom-container tip"},[(0,r._)("p",{class:"custom-container-title"},"Use output"),(0,r._)("p",null,"There are many ways you can use the output:"),(0,r._)("ul",null,[(0,r._)("li",null,"Turn on/off a switch"),(0,r._)("li",null,"Set a thermostat up, down or to specific values"),(0,r._)("li",null,"Change setting of a dimmer"),(0,r._)("li",null,"Send a notification")])],-1),Ne=(0,r._)("h3",{id:"display-schedule",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#display-schedule","aria-hidden":"true"},"#"),(0,r.Uk)(" Display schedule")],-1),Pe=(0,r._)("p",null,[(0,r._)("strong",null,"Output 3"),(0,r.Uk)(" can be used to print or display the calculated schedule. If you just want to see it, send it to a debug node. You can also use it to display the result as graphs in HA.")],-1),Ee=(0,r._)("p",null,[(0,r.Uk)("For users of Magic Mirror and Tibber, the "),(0,r._)("code",null,"ps-best-save"),(0,r.Uk)(" node can send its schedule to the MMM-Tibber module. See more details in the "),(0,r._)("code",null,"ps-best-save"),(0,r.Uk)(" node documentation.")],-1),We=(0,r._)("h3",{id:"more-information",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#more-information","aria-hidden":"true"},"#"),(0,r.Uk)(" More information")],-1),He=(0,r.Uk)("There are more details and more information in the documentation for each "),Ie={href:"/nodes/",target:"_blank",rel:"noopener noreferrer"},Me=(0,r.Uk)("node"),Ce=(0,r.Uk)(" and in the "),Ge={href:"/examples/",target:"_blank",rel:"noopener noreferrer"},De=(0,r.Uk)("examples"),Oe=(0,r.Uk)("."),Re=(0,r._)("h2",{id:"migration-from-v2",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#migration-from-v2","aria-hidden":"true"},"#"),(0,r.Uk)(" Migration from v2")],-1),Ye=(0,r._)("p",null,[(0,r.Uk)("The "),(0,r._)("code",null,"Power Saver"),(0,r.Uk)(" node from v2 is still here, and it is working exactly as before. However, it will not be further maintained, so you should replace it. You may directly replace the "),(0,r._)("code",null,"Power Saver"),(0,r.Uk)(" node by two of the new nodes:")],-1),Le=(0,r._)("p",null,[(0,r._)("img",{src:o,alt:"Migrate Power Saver"})],-1),je=(0,r.Uk)("See more details in the "),Be=(0,r.Uk)("documentation for the "),Ze=(0,r._)("code",null,"ps-strategy-best-save",-1),Fe=(0,r.Uk)(" node."),ze={},Je=(0,n(3744).Z)(ze,[["render",function(e,t){const n=(0,r.up)("OutboundLink"),l=(0,r.up)("CodeGroupItem"),a=(0,r.up)("CodeGroup"),o=(0,r.up)("RouterLink");return(0,r.wg)(),(0,r.iD)(r.HY,null,[s,i,(0,r._)("p",null,[u,(0,r._)("a",d,[c,(0,r.Wm)(n)]),h]),p,_,b,m,f,g,v,y,k,w,U,x,T,A,S,q,N,P,E,(0,r._)("p",null,[W,H,I,(0,r._)("a",M,[C,(0,r.Wm)(n)]),G]),(0,r.Wm)(a,null,{default:(0,r.w5)((()=>[(0,r.Wm)(l,{title:"All homes"},{default:(0,r.w5)((()=>[D])),_:1}),(0,r.Wm)(l,{title:"Single home",active:""},{default:(0,r.w5)((()=>[O])),_:1})])),_:1}),R,(0,r._)("p",null,[Y,(0,r._)("a",L,[j,(0,r.Wm)(n)]),B]),Z,(0,r._)("p",null,[(0,r.Wm)(o,{to:"/examples/example-tibber-mqtt.html"},{default:(0,r.w5)((()=>[F])),_:1})]),(0,r._)("p",null,[z,(0,r._)("a",J,[K,(0,r.Wm)(n)]),Q,V,X,$,ee,te,ne]),(0,r._)("p",null,[(0,r.Wm)(o,{to:"/examples/example-nordpool-current-state.html"},{default:(0,r.w5)((()=>[re,le,ae])),_:1})]),(0,r._)("p",null,[(0,r.Wm)(o,{to:"/examples/example-nordpool-events-state.html"},{default:(0,r.w5)((()=>[oe,se,ie])),_:1})]),ue,de,ce,he,pe,_e,be,me,fe,ge,ve,ye,ke,we,Ue,xe,Te,Ae,Se,qe,Ne,Pe,Ee,We,(0,r._)("p",null,[He,(0,r._)("a",Ie,[Me,(0,r.Wm)(n)]),Ce,(0,r._)("a",Ge,[De,(0,r.Wm)(n)]),Oe]),Re,Ye,Le,(0,r._)("p",null,[je,(0,r.Wm)(o,{to:"/nodes/ps-strategy-best-save.html"},{default:(0,r.w5)((()=>[Be,Ze])),_:1}),Fe])],64)}]])},3744:(e,t)=>{t.Z=(e,t)=>{const n=e.__vccOpts||e;for(const[e,r]of t)n[e]=r;return n}},1321:(e,t,n)=>{e.exports=n.p+"assets/img/example-flow-1.3ff3e23f.png"},3405:(e,t,n)=>{e.exports=n.p+"assets/img/example-flow-2.b653b58d.png"},1758:(e,t,n)=>{e.exports=n.p+"assets/img/migrate-best-save.f73420f6.png"}}]);